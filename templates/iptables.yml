#!/bin/bash
export PATH=/sbin/:{$PATH}

iptables -P INPUT DROP
iptables -P FORWARD DROP

iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -p tcp -s 0.0.0.0/0 -m state --state NEW -m multiport --dports {{tcp_ports_allowed}} -j ACCEPT
iptables -A INPUT -p udp -s 0.0.0.0/0 -m state --state NEW -m multiport --dports {{udp_ports_allowed}} -j ACCEPT
iptables -A INPUT -j DROP

#allow connections to the docker on external interface
iptables -A FORWARD -i docker0 -o {{ext_if}} -j ACCEPT
iptables -A FORWARD -i {{ext_if}} -o docker0 -j ACCEPT

#allow connections to the docker on internal interface
iptables -A FORWARD -i docker0 -o {{inner_if}} -j ACCEPT
iptables -A FORWARD -i {{inner_if}} -o docker0 -j ACCEPT
